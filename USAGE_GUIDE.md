# 📖 智能衣柜使用指南

完整的用户使用说明和后端配置指南。

---

## 📋 目录

- [快速开始](#快速开始)
- [后端配置](#后端配置)
- [前端功能使用](#前端功能使用)
- [虚拟试穿详解](#虚拟试穿详解)
- [照片管理](#照片管理)
- [数据备份与恢复](#数据备份与恢复)
- [常见问题](#常见问题)
- [故障排查](#故障排查)

---

## 🚀 快速开始

### 第一步：启动后端服务

```bash
cd backend
npm run dev:fixed
```

✅ 后端启动成功提示：
```
✅ 服务器启动成功: http://localhost:3100
📝 环境: production
🔑 阿里云 AccessKey: 已配置
```

### 第二步：启动前端

```bash
npm run dev:fixed
```

✅ 前端启动成功提示：
```
VITE v5.x.x ready in xxx ms
➜ Local: http://localhost:5173/
```

### 第三步：访问应用

打开浏览器访问：**http://localhost:5173**

---

## 🔧 后端配置

### 配置说明

所有敏感配置存储在 `backend/.env` 文件中：

```env
# 阿里云 AccessKey 配置
ALIYUN_ACCESS_KEY_ID=你的AccessKey_ID
ALIYUN_ACCESS_KEY_SECRET=你的AccessKey_Secret

# 阿里云百炼 API Key
ALIYUN_BAILIAN_API_KEY=sk-你的百炼API-Key

# OSS 存储配置
OSS_BUCKET=你的bucket名称
OSS_REGION=oss-cn-beijing

# 服务器配置
PORT=3100
NODE_ENV=production
```

### 环境变量说明

| 变量名 | 说明 | 获取方式 |
|--------|------|---------|
| `ALIYUN_ACCESS_KEY_ID` | 阿里云 AccessKey ID | [RAM 控制台](https://ram.console.aliyun.com/manage/ak) |
| `ALIYUN_ACCESS_KEY_SECRET` | 阿里云 AccessKey Secret | [RAM 控制台](https://ram.console.aliyun.com/manage/ak) |
| `ALIYUN_BAILIAN_API_KEY` | 百炼 API Key | [百炼控制台](https://bailian.console.aliyun.com/) |
| `OSS_BUCKET` | OSS Bucket 名称 | [OSS 控制台](https://oss.console.aliyun.com/bucket) |
| `OSS_REGION` | OSS Region | OSS控制台查看（如: oss-cn-beijing）|
| `PORT` | 后端服务端口 | 默认 3100 |
| `NODE_ENV` | 运行环境 | production/development |

### 获取配置密钥

#### 1. 获取 AccessKey（用于OSS）

1. 访问 [RAM 访问控制](https://ram.console.aliyun.com/manage/ak)
2. 登录阿里云账号
3. 创建 AccessKey
4. 复制 `AccessKey ID` 和 `AccessKey Secret`
5. ⚠️ **安全提示**：请妥善保管，不要泄露

#### 2. 获取百炼 API Key

1. 访问 [阿里云百炼](https://bailian.console.aliyun.com/)
2. 进入"密钥管理"
3. 创建 API-KEY
4. 复制以 `sk-` 开头的密钥

#### 3. 配置 OSS Bucket

1. 访问 [OSS 控制台](https://oss.console.aliyun.com/bucket)
2. 创建 Bucket（如果还没有）
3. 记录 Bucket 名称和 Region
4. ⚠️ **权限设置**：建议设置为"公共读"

### 修改配置

如需修改配置：

1. **编辑配置文件**
   ```bash
   # 编辑 backend/.env
   ALIYUN_BAILIAN_API_KEY=sk-新的API-Key
   OSS_BUCKET=新的bucket名称
   ```

2. **重启后端服务器**
   ```bash
   cd backend
   npm run dev:fixed
   ```

3. **测试连接**
   - 在前端"设置"页面点击"测试后端连接"
   - 确认配置生效

### 安全性

✅ **前端不再需要填写配置** - 所有敏感信息都在后端  
✅ **.env 文件已被 .gitignore** - 不会被提交到 Git  
✅ **后端 API 验证** - 前端通过后端调用百炼 API  

---

## 🎨 前端功能使用

### 1️⃣ 衣物管理

#### 添加衣物

1. 进入 **"我的衣柜"** 页面
2. 点击 **"添加衣物"** 按钮
3. 上传衣物图片
4. 填写衣物信息：
   - 名称（如：白色T恤）
   - 类别（上装/下装/连衣裙/鞋子/配饰）
   - 颜色（系统自动识别，可手动调整）
   - 适合季节（春/夏/秋/冬）
   - 标签（休闲/正式/运动等）
5. 点击 **"保存"**

#### 智能抠图

如果衣物图片有背景，可以使用"智能抠图"功能：
1. 上传图片后点击 **"智能抠图"**
2. 等待 AI 处理（约 3-5 秒）
3. 预览去背景效果
4. 满意后保存

#### 管理衣物

- **编辑**：点击衣物卡片 → "编辑"按钮
- **删除**：点击衣物卡片 → "删除"按钮
- **筛选**：使用顶部筛选器按类别/季节/颜色筛选
- **搜索**：输入关键词搜索衣物名称或标签

---

### 2️⃣ 虚拟试穿

#### 开始试穿

1. 进入 **"虚拟试穿"** 页面

2. **上传全身照**
   - 点击上传区域选择照片
   - 建议：正面站立、全身入镜、纯色背景
   - 可使用"智能抠图"去除背景

3. **选择试穿模式**
   - **单件试穿**：选择一件衣服（上装/下装/连衣裙）
   - **上下装试穿**：分别选择上装和下装

4. **选择衣物**
   - 单件模式：选择一件衣物即可
   - 上下装模式：需要选择上装和下装各一件

5. **开始试穿**
   - 点击 **"开始试穿"** 按钮
   - 等待提示："任务已提交！正在处理中..."
   - 系统自动轮询结果（约 10-60 秒）
   - 完成后显示试穿效果图

6. **保存结果**
   - 点击 **"下载图片"** 保存试穿效果

#### 试穿工作流程

```
用户操作                前端                后端                 阿里云
   ↓                     ↓                   ↓                    ↓
上传照片 ───────→ 调用后端API ───────→ 上传图片到OSS ────→ 获取公网URL
选择衣物                              ↓                    ↓
   ↓                                  调用百炼API ────────→ AI处理
点击试穿                              ↓                    ↓
   ↓                     ↓            返回任务ID ←─────── 异步处理
等待处理 ←──────── 轮询任务状态 ←──── 查询任务结果          ↓
   ↓                     ↓            ↓                    ↓
显示结果 ←──────── 下载结果图片 ←──── 返回结果URL ←────── 处理完成
```

#### 照片拍摄技巧

1. **正面站立**：面向镜头，双手自然下垂
2. **全身入镜**：从头到脚完整拍摄
3. **单一背景**：选择纯色背景或简单场景
4. **光线充足**：避免逆光或阴影
5. **比例协调**：手机竖屏拍摄，保持距离适中

#### 衣物图片要求

- **背景**：透明或纯色背景
- **角度**：正面平铺
- **质量**：清晰、完整
- **格式**：JPG、PNG 均可
- **大小**：建议 < 2MB（系统会自动压缩）

---

### 3️⃣ 照片管理

#### 保存常用照片

首次上传照片时，系统会提示是否保存：
1. 点击 **"保存并设为默认"**
2. 照片保存到本地浏览器
3. 下次自动加载，无需重复上传

#### 管理我的照片

1. 点击 **"我的照片"** 按钮
2. 查看所有已保存的照片
3. 操作选项：
   - **切换照片**：点击任意照片即可使用
   - **设为默认**：鼠标悬停 → "设为默认"
   - **删除照片**：鼠标悬停 → "删除"

#### 多照片策略

建议保存多种场景的照片：
- **正面全身照**（默认）：用于大部分试穿
- **侧面照**：查看衣物侧面效果
- **不同姿势**：展示不同穿搭风格

#### 数据存储

- **位置**：浏览器本地 IndexedDB 数据库
- **容量**：支持存储多张照片（每张约 1-2MB 压缩后）
- **安全**：完全离线，数据不上传服务器

---

### 4️⃣ 搭配推荐

进入 **"搭配推荐"** 页面：
- 查看系统根据季节、场合推荐的搭配方案
- 点击"试穿此搭配"快速体验
- 保存喜欢的搭配方案

---

## 💾 数据备份与恢复

### 自动备份

系统每 24 小时自动备份到浏览器本地存储，包含：
- ✅ 所有衣物数据
- ✅ 搭配方案
- ✅ 保存的照片
- ✅ 用户设置

### 手动备份

1. 进入 **"设置"** 页面
2. 找到 **"数据管理"** 部分
3. 点击 **"立即备份到文件"**
4. 下载 JSON 文件，妥善保存

### 恢复数据

1. 进入 **"设置"** 页面
2. 点击 **"导入数据"**
3. 选择之前导出的 JSON 文件
4. 确认导入，所有数据恢复完成

### 清空数据

如需清空所有数据：
1. 进入 **"设置"** → **"数据管理"**
2. 点击 **"清空所有数据"**
3. 确认操作（⚠️ 此操作不可逆）

---

## ❓ 常见问题

### Q1: 照片会上传到服务器吗？

**A:** 分两种情况：
- **保存的照片**：存储在您的浏览器本地，完全离线
- **试穿时的照片**：会临时上传到阿里云OSS进行AI处理，处理完成后可以删除

### Q2: 更换浏览器或设备后数据还在吗？

**A:** 数据存储在浏览器本地，更换设备后需要导入备份：
1. 在旧设备："设置" → "导出数据"
2. 在新设备："设置" → "导入数据"

### Q3: 虚拟试穿要付费吗？

**A:** 需要。使用阿里云百炼AI试穿服务：
- 按次计费：约 ¥0.2-0.3/次
- 需要在阿里云账户充值
- 可在百炼控制台查看消费记录

### Q4: 试穿效果不理想怎么办？

**A:** 尝试以下方法改善：
- 使用更清晰的全身照
- 去除背景（使用智能抠图）
- 确保人物姿势自然、正面站立
- 选择清晰、完整的衣物图片
- 确保衣物类别选择正确（上装/下装）

### Q5: 智能抠图失败怎么办？

**A:** 智能抠图需要：
- 图片清晰度足够
- 主体明确（人物或衣物）
- 背景相对简单
- 如果失败，可以手动使用图片编辑工具处理

### Q6: 可以保存多少衣物？

**A:** 理论上无限制，取决于浏览器存储空间（通常可存储数百件衣物）

### Q7: 数据会丢失吗？

**A:** 以下情况可能丢失数据：
- 清除浏览器缓存
- 卸载浏览器
- 系统重装

**预防措施**：定期在"设置"页面导出备份

---

## 🚨 故障排查

### 问题1：前端显示"无法连接到后端服务器"

**可能原因：**
- 后端服务未启动
- 端口被占用
- 网络问题

**解决方法：**

1. **检查后端是否运行**
   ```bash
   # Windows
   netstat -ano | findstr "3100"
   
   # Linux/macOS
   lsof -i :3100
   ```

2. **启动后端服务**
   ```bash
   cd backend
   npm run dev:fixed
   ```

3. **检查终端输出**
   - 查看是否有错误信息
   - 确认服务已启动

4. **刷新前端页面**

---

### 问题2：虚拟试穿失败

**排查步骤：**

1. **检查后端日志**
   - 查看终端输出的错误信息

2. **测试后端连接**
   - 在"设置"页面点击"测试后端连接"
   - 确认配置正常

3. **检查图片要求**
   - 人物照片：清晰、全身入镜
   - 衣物图片：完整、清晰
   - 文件大小：< 20MB

4. **查看浏览器控制台**
   - 按 F12 打开开发者工具
   - 查看 Console 中的错误信息

5. **检查API配置**
   ```bash
   curl http://localhost:3100/api/config
   ```
   确认所有配置项均已正确设置

---

### 问题3：任务一直处理中

**可能原因：**
- 百炼 API 处理时间较长（正常 10-60 秒）
- 图片太大导致处理慢
- 网络问题

**解决方法：**
- 等待更长时间（最多 2 分钟）
- 压缩图片后重试（系统会自动压缩到 2MB 以下）
- 检查网络连接
- 查看百炼控制台的任务状态

---

### 问题4：智能抠图不生效

**可能原因：**
- 图片质量不足
- AI 服务暂时不可用
- 浏览器兼容性问题

**解决方法：**
- 更换更清晰的图片
- 使用其他浏览器尝试（推荐 Chrome/Edge）
- 手动使用图片编辑工具去背景

---

### 问题5：OSS 上传失败

**可能原因：**
- AccessKey 配置错误
- Bucket 权限不足
- Region 配置错误

**解决方法：**

1. **检查配置**
   ```bash
   curl http://localhost:3100/api/config
   ```

2. **确认 OSS 权限**
   - 登录 OSS 控制台
   - 确认 Bucket 权限设置为"公共读"
   - 确认 AccessKey 有 OSS 访问权限

3. **重启后端服务**
   ```bash
   cd backend
   npm run dev:fixed
   ```

---

## 🎯 使用技巧

### 1. 批量试穿

保存一张常用全身照，然后快速切换不同衣物试穿，高效对比效果。

### 2. 搭配方案

为重要场合（面试、约会、聚会）提前准备多套搭配，保存为搭配方案。

### 3. 季节管理

按季节标记衣物，换季时快速找到合适的衣服。

### 4. 定期备份

每周或每月导出一次数据备份，防止意外丢失。

### 5. 照片库

保存多张不同角度、不同场景的照片，适应不同试穿需求。

---

## 📞 技术支持

### 查看日志

**后端日志：**
```bash
cd backend
npm run dev:fixed
# 查看终端输出
```

**浏览器日志：**
1. 按 F12 打开开发者工具
2. 切换到 "Console" 标签
3. 查看错误信息

### 联系支持

如遇到无法解决的问题：
1. 记录错误信息
2. 截图问题现象
3. 查看 `README.md` 获取项目信息

---

## 🎊 开始使用吧！

现在一切就绪，您可以：

1. ✅ 添加你的第一件衣物
2. ✅ 上传全身照
3. ✅ 体验虚拟试穿
4. ✅ 创建搭配方案
5. ✅ 享受智能衣柜带来的便利！

**祝您使用愉快！** 🎉

